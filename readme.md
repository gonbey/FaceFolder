# 顔認識アプリケーション README

## 概要

このPythonアプリケーションは、指定されたインポートフォルダ内の画像を再帰的に探索し、顔認識を行います。検出された顔に基づいて画像を分類し、各人物ごとにIDを割り当てて出力フォルダに整理します。また、各人物のフォルダ内に、認識された顔に枠を付けたサムネイル画像を生成します。

## 特徴

- **顔認識と分類**: 画像内の顔を検出し、既知の顔と比較して同一人物を識別します。
- **再帰的なフォルダ探索**: インポートフォルダ内のサブフォルダも含めて画像を探索します。
- **サムネイルの生成**: 各人物のフォルダに、顔に枠を付けたサムネイル画像を生成します。
- **ディレクトリ構造の保持**: 元のフォルダ構造を出力フォルダ内で再現します。

## 前提条件

- **Python 3.6以上**
- 以下のPythonライブラリ:

  - `insightface`
  - `opencv-python`
  - `numpy`

## インストール

1. **Pythonのインストール**

   Pythonがインストールされていない場合は、[公式サイト](https://www.python.org/downloads/)からPython 3.6以上をダウンロードしてインストールしてください。

2. **仮想環境の作成（オプション）**

   ```bash
   python -m venv venv
   ```

   仮想環境を有効化:

   - Windows:

     ```bash
     venv\Scripts\activate
     ```

   - macOS/Linux:

     ```bash
     source venv/bin/activate
     ```

3. **必要なライブラリのインストール**

   以下のコマンドを実行して、必要なライブラリをインストールします。

   ```bash
   pip install insightface opencv-python numpy
   ```

   もし`pip`を最新バージョンにアップグレードしていない場合は、先に以下を実行してください。

   ```bash
   python -m pip install --upgrade pip
   ```

## 使い方

1. **スクリプトの設定**

   スクリプト内の以下の部分を、実際のパスに置き換えてください。

   ```python
   import_folder = "C:/path/to/import_folder"  # インポートフォルダのパス
   output_folder = "C:/path/to/output_folder"  # 出力フォルダのパス
   ```

2. **インポートフォルダの準備**

   インポートフォルダに、処理したい画像ファイルを配置してください。サブフォルダ内の画像も再帰的に処理されます。

3. **スクリプトの実行**

   ターミナルまたはコマンドプロンプトで以下のコマンドを実行します。

   ```bash
   python main.py
   ```

   ※ スクリプトのファイル名が`main.py`である場合。

4. **結果の確認**

   出力フォルダ内に、以下のような構造で結果が生成されます。

   ```
   output_folder/
   ├── 1/
   │   ├── サブフォルダ1/
   │   │   ├── 画像1.jpg
   │   │   └── 画像2.jpg
   │   ├── サブフォルダ2/
   │   │   └── 画像3.jpg
   │   ├── thumbnail.jpg
   ├── 2/
   │   ├── サブフォルダ1/
   │   │   └── 画像4.jpg
   │   ├── thumbnail.jpg
   └── ...
   ```

   - 各IDのフォルダには、その人物が含まれる画像が整理されます。
   - `thumbnail.jpg`は、認識された顔に枠が付けられたサムネイル画像です。

## 注意事項

- **顔認識の精度**

  - 類似度の閾値（デフォルトでは`0.5`）は、データセットに応じて調整してください。
  - スクリプト内の以下の部分を変更することで調整できます。

    ```python
    if max_similarity > 0.5:
        # 一致すると判断
    ```

- **GPUの使用**

  - デフォルトではCPUを使用します。GPUを使用して処理を高速化したい場合は、CUDAがインストールされた環境で`ctx_id`を`0`に設定します。

    ```python
    app.prepare(ctx_id=0)
    ```

  - CPUのみを使用する場合は、`ctx_id`を`-1`に設定します。

    ```python
    app.prepare(ctx_id=-1)
    ```

- **ファイルパスに日本語が含まれる場合**

  - ファイルパスやファイル名に日本語などの非ASCII文字が含まれる場合、正しく処理できないことがあります。
  - 可能であれば、英数字のみを使用することをお勧めします。

## トラブルシューティング

- **ライブラリのインストールエラー**

  - ライブラリのインストール時にエラーが発生した場合、`pip`を最新バージョンにアップデートしてください。

    ```bash
    python -m pip install --upgrade pip
    ```

- **画像が読み込めない**

  - OpenCVが画像を読み込めない場合、ファイルパスや画像形式を確認してください。
  - ファイルパスに特殊文字が含まれていると問題が発生する可能性があります。

- **エラーが発生してスクリプトが停止する**

  - エラーメッセージを確認し、問題の箇所を特定してください。
  - 必要に応じて、エラーハンドリングを強化することを検討してください。

## ライセンス

このプロジェクトは、MITライセンスの下で提供されます。

---

もし何かご不明な点や問題がございましたら、お気軽にお問い合わせください。
